@model IEnumerable<Item>

<h3>Hello from tripcontroller and trip viev!</h3>

    <p>
       <input type="text" name="TripName" placeholder="Max 100 sign" id="textareaForTrip"
                  cols="30"  maxlength="100" minlength="2" required>
        
    </p>
    <p>
    <p>
        <h3>Choose your Items for that Trip</h3>
    </p>
    @foreach (var item in Model)
    {
        <div>
            <input type="checkbox" name="ItemsToTrip" value="@item.Id"/>@item.ItemName
        </div>
    }
    </p>
    <p>
        <button onclick="createTripWithItems()">Create Trip</button>
    </p>
</form>

<script>
    let markedItemsNames = []; 
    let tripName;
    function createTripWithItems() {
        getItems();
        getTripName();
        finalfunction();
    }
    function getItems() {
        var signedCheckBox = document.getElementsByName('ItemsToTrip');
        for (var checkbox of signedCheckBox) {
            if (checkbox.checked)
                markedItemsNames.push(Number.parseInt(checkbox.value));
            }
       }
    function getTripName() {
       
        tripName = document.getElementById("textareaForTrip").value;
       }
    function toStringList() { 
        var str ='';
        for (var i = 0; i < markedItemsNames.length; i++) {
            str += '&tripId[' + i + ']=' + markedItemsNames[i];
        }
        return str;
    }
    //function jsonBuilder() {
    //    let newCreatedTrip = {
    //        tripName: tripName, 
    //        itemsListToTrip: markedItemsNames
    //    };
    //    return JSON.stringify(newCreatedTrip);
    //}
    function finalfunction() {
       
        var xhttp = new XMLHttpRequest();
        //var variable = jsonBuilder();
       // alert(variable);   /Artist/GetImages/?artistName=cher&apiKey=XXX   string name, int[] tripid
        xhttp.open('POST', '/trip/createtrip/?name=' + tripName + toStringList());
        //xhttp.setRequestHeader('Content-type', 'application/json');
        xhttp.send(); // may not vvork
        alert("Your trip");
        window.location.href = "/trip/index";
    }

</script>